# validation-microservice

**Microservice for Comparative Analysis of Deep Learning Models and Expert Annotations in Biomedical Images.**

–°–µ—Ä–≤–∏—Å –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç—ã –Ω–µ–π—Ä–æ—Å–µ—Ç–µ–π (Inference) –ø—É—Ç–µ–º —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å —ç–∫—Å–ø–µ—Ä—Ç–Ω–æ–π —Ä–∞–∑–º–µ—Ç–∫–æ–π (Ground Truth). –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è ‚Äî –æ–Ω–∫–æ–≥–µ–º–∞—Ç–æ–ª–æ–≥–∏—è (–ø–æ–¥—Å—á–µ—Ç –∫–ª–µ—Ç–æ–∫ –∫–æ—Å—Ç–Ω–æ–≥–æ –º–æ–∑–≥–∞).

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–û–ø–∏—Å–∞–Ω–∏–µ –∏ –¶–µ–ª–∏](#–æ–ø–∏—Å–∞–Ω–∏–µ-–∏-—Ü–µ–ª–∏)
2. [–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫](#—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π-—Å—Ç–µ–∫)
3. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–∏-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)
4. [–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è](#—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
5. [–§–æ—Ä–º–∞—Ç—ã –¥–∞–Ω–Ω—ã—Ö](#—Ñ–æ—Ä–º–∞—Ç—ã-–¥–∞–Ω–Ω—ã—Ö)
6. [–ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞ (MVP)](#–∑–∞–ø—É—Å–∫-–ø—Ä–æ–µ–∫—Ç–∞-mvp)
7. [Roadmap](#roadmap)

---

## üéØ –û–ø–∏—Å–∞–Ω–∏–µ –∏ –¶–µ–ª–∏

### –ü—Ä–æ–±–ª–µ–º–∞
–ú–æ–¥–µ–ª–∏ –≥–ª—É–±–æ–∫–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, YOLO) –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –≤—ã—Å–æ–∫—É—é —Ç–æ—á–Ω–æ—Å—Ç—å (~92%), –Ω–æ –≤ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π –ø—Ä–∞–∫—Ç–∏–∫–µ (–∫–ª–∏–Ω–∏–∫–µ) –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤. –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –Ω–µ –ø–æ–∑–≤–æ–ª—è—é—Ç —É–¥–æ–±–Ω–æ —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–æ–¥–µ–ª–∏ —Å –º–Ω–µ–Ω–∏–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—á–∏—Ç–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –æ—à–∏–±–æ–∫.

### –¶–µ–ª—å
–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–π, –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
1.  **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∏–Ω—Ñ–µ—Ä–µ–Ω—Å** –Ω–æ–≤—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —á–µ—Ä–µ–∑ ONNX-–º–æ–¥–µ–ª—å.
2.  **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ** –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –º–æ–¥–µ–ª–∏ —Å —Ä–∞–∑–º–µ—Ç–∫–æ–π —ç–∫—Å–ø–µ—Ä—Ç–æ–≤.
3.  **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é** —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π (Bounding Boxes) –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ.
4.  **–†–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫** (IoU, Cohen's Kappa, Confusion Matrix).

---

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### Core
*   **Backend:** Python 3.10+, **FastAPI**.
*   **Frontend:** **React**, Vite.
*   **Database:** **PostgreSQL** (—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö, —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤–∞–ª–∏–¥–∞—Ü–∏–∏, –ª–æ–≥–æ–≤).
*   **AI Engine:** **ONNX Runtime** (–∑–∞–ø—É—Å–∫ –º–æ–¥–µ–ª–µ–π YOLOv8).

### Infrastructure
*   **Containerization:** Docker, Docker Compose.
*   **Protocols:** REST API (Internal), gRPC (Potential external integration).

---

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

–°–µ—Ä–≤–∏—Å –ø—Ä–æ–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ **–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π –º–æ–¥—É–ª—å**, –≥–æ—Ç–æ–≤—ã–π –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –º–µ–¥–∏—Ü–∏–Ω—Å–∫—É—é —ç–∫–æ—Å–∏—Å—Ç–µ–º—É (C++/Qt Desktop, Python/Web Annotation).

### Data Access Layer (–ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö)
–ß—Ç–æ–±—ã –æ–±–µ—Å–ø–µ—á–∏—Ç—å –≥–∏–±–∫–æ—Å—Ç—å (—Ä–∞–±–æ—Ç—É –∫–∞–∫ –ª–æ–∫–∞–ª—å–Ω–æ, —Ç–∞–∫ –∏ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏), –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–∞—Ç—Ç–µ—Ä–Ω **Provider/Adapter**.

–°–µ—Ä–≤–∏—Å –æ–ø–µ—Ä–∏—Ä—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏:
*   `IImageProvider` ‚Äî –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–ª—É—á–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.
*   `IAnnotationProvider` ‚Äî –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ç–∫–∏.

**–†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã (Environment Modes):**
1.  **DEV (MVP):**
    *   `LocalFSImageProvider`: –ß–∏—Ç–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –ø–∞–ø–∫–∏ `./data/images`.
    *   `LocalFSAnnotationProvider`: –ß–∏—Ç–∞–µ—Ç .txt —Ñ–∞–π–ª—ã –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –ø–∞–ø–∫–∏ `./data/labels`.
    *   –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: PostgreSQL –≤ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ.
2.  **PROD (Future):**
    *   `RemoteGrpcImageProvider`: –ü–æ–ª—É—á–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º—ã —Ö—Ä–∞–Ω–µ–Ω–∏—è (C++/gRPC).
    *   `ExternalDBAnnotationProvider`: –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –≤–Ω–µ—à–Ω–µ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π.

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 1. –ë—ç–∫–µ–Ω–¥ (FastAPI)
*   **Inference API:** –ü—Ä–∏–Ω–∏–º–∞–µ—Ç ID –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -> –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∫–∞—Ä—Ç–∏–Ω–∫—É -> –ü—Ä–æ–≥–æ–Ω—è–µ—Ç —á–µ—Ä–µ–∑ ONNX -> –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –±–æ–∫—Å–æ–≤.
*   **Comparison Engine:**
    *   –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –±–æ–∫—Å–æ–≤ –ú–æ–¥–µ–ª–∏ –∏ –≠–∫—Å–ø–µ—Ä—Ç–∞ —á–µ—Ä–µ–∑ **IoU (Intersection over Union) ‚â• 0.5**.
    *   –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –æ—à–∏–±–æ–∫: True Positive, False Positive, False Negative.
*   **Statistics:** –†–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ (Kappa, Accuracy, F1).

### 2. –§—Ä–æ–Ω—Ç–µ–Ω–¥ (React)
*   **Dashboard:** –°–ø–∏—Å–æ–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –∫—Ä–∞—Ç–∫–∏–º —Å—Ç–∞—Ç—É—Å–æ–º (–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ/–ù–µ—Ç).
*   **Interactive Viewer:**
    *   –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.
    *   –ù–∞–ª–æ–∂–µ–Ω–∏–µ —Å–ª–æ–µ–≤ (Layers): –°–ª–æ–π "–í—Ä–∞—á" (–ó–µ–ª–µ–Ω—ã–π), –°–ª–æ–π "–ú–æ–¥–µ–ª—å" (–ö—Ä–∞—Å–Ω—ã–π).
    *   –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–∫–ª—é—á–µ–Ω–∏—è/–≤—ã–∫–ª—é—á–µ–Ω–∏—è —Å–ª–æ–µ–≤.
*   **Reporting:** –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ –ø–æ —Ç–µ–∫—É—â–µ–º—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é.

---

## üìÇ –§–æ—Ä–º–∞—Ç—ã –¥–∞–Ω–Ω—ã—Ö

### –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
1.  **–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:** –§–æ—Ä–º–∞—Ç—ã PNG, JPEG2000. –ò–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤ ‚Äî UUID.
2.  **–ê–Ω–Ω–æ—Ç–∞—Ü–∏–∏:** –¢–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã `.txt` –≤ —Ñ–æ—Ä–º–∞—Ç–µ **YOLO**:
    ```text
    <class_id> <x_center> <y_center> <width> <height>
    ```
    *–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω—ã (–æ—Ç 0 –¥–æ 1).*
3.  **–ú–æ–¥–µ–ª—å:** –§–∞–π–ª `.onnx` (—ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π YOLOv8).
4.  **–ö–ª–∞—Å—Å—ã:** 22 —Ç–∏–ø–∞ –∫–ª–µ—Ç–æ–∫ (–±–ª–∞—Å—Ç—ã, –ª–∏–º—Ñ–æ—Ü–∏—Ç—ã, –Ω–æ—Ä–º–æ–±–ª–∞—Å—Ç—ã –∏ –¥—Ä.).

---

## üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞ (MVP)

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –∏ —Å–µ—Ä–≤–∏—Å–æ–º:

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <repo_url>

# –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
# –ü–æ–ª–æ–∂–∏—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫–∏ –≤ ./data/images
# –ü–æ–ª–æ–∂–∏—Ç—å —Ä–∞–∑–º–µ—Ç–∫—É –≤ ./data/labels
# –ü–æ–ª–æ–∂–∏—Ç—å –º–æ–¥–µ–ª—å –≤ ./models/model.onnx

# –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose
docker-compose up --build
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:
*   **Frontend:** http://localhost:3000
*   **Backend API Docs:** http://localhost:8000/docs

---

## üìÖ Roadmap

### Stage 1: Analysis & Architecture (Current)
- [x] –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π.
- [x] –í—ã–±–æ—Ä —Å—Ç–µ–∫–∞ (FastAPI + React).
- [ ] –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤.
- [ ] –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑–æ–≤—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –¥–∞–Ω–Ω—ã—Ö (Local FS).

### Stage 2: MVP Implementation
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Docker Environment.
- [ ] –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª—è ONNX Inference.
- [ ] –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è (IoU calculation).
- [ ] –ë–∞–∑–æ–≤—ã–π UI –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ–¥–Ω–æ–π –∫–∞—Ä—Ç–∏–Ω–∫–∏ —Å –Ω–∞–ª–æ–∂–µ–Ω–∏–µ–º —Ä–∞–º–æ–∫.

### Stage 3: Visualization & Metrics
- [ ] –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π Dashboard —Å–æ —Å–ø–∏—Å–∫–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.
- [ ] –†–∞—Å—á–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (Confusion Matrix, Kappa).
- [ ] –≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–æ–≤.

### Stage 4: Integration & Testing
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –¥–∞—Ç–∞—Å–µ—Ç–µ (210 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π).
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API.
- [ ] –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ Docker-–æ–±—Ä–∞–∑–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞.