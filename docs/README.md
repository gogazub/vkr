# TODO –æ–±–Ω–æ–≤–∏—Ç—å README

# Validation Microservice

**Microservice for Comparative Analysis of Deep Learning Models and Expert Annotations in Biomedical Images.**

–°–µ—Ä–≤–∏—Å –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç—ã –Ω–µ–π—Ä–æ—Å–µ—Ç–µ–π (Inference) –ø—É—Ç–µ–º —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å —ç–∫—Å–ø–µ—Ä—Ç–Ω–æ–π —Ä–∞–∑–º–µ—Ç–∫–æ–π (Ground Truth). –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è ‚Äî –æ–Ω–∫–æ–≥–µ–º–∞—Ç–æ–ª–æ–≥–∏—è (–ø–æ–¥—Å—á–µ—Ç –∫–ª–µ—Ç–æ–∫ –∫–æ—Å—Ç–Ω–æ–≥–æ –º–æ–∑–≥–∞).

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Makefile (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
make help

# –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (—Å–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫)
make start

# –ò–ª–∏ –ø–æ—à–∞–≥–æ–≤–æ:
make build    # –°–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã
make up-d     # –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
```

### –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã (PostgreSQL + API)
docker-compose up --build

# –ò–ª–∏ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
docker-compose up -d --build
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: `http://localhost:8000`

- **API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (Swagger):** http://localhost:8000/docs
- **API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (ReDoc):** http://localhost:8000/redoc
- **Health check:** http://localhost:8000/health

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
microservice/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ main.py              # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ config.py            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ utils/               # –£—Ç–∏–ª–∏—Ç—ã –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ tests/                   # –¢–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ data/                    # –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–Ω–µ –≤ git)
‚îÇ   ‚îú‚îÄ‚îÄ images/
‚îÇ   ‚îî‚îÄ‚îÄ labels/
‚îú‚îÄ‚îÄ models/                  # ONNX –º–æ–¥–µ–ª–∏ (–Ω–µ –≤ git)
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ Makefile
‚îî‚îÄ‚îÄ README.md
```

## üîß –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (—Å–º. `.env.example`):

- `ENV_MODE` - —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã (DEV/PROD)
- `DEBUG` - —Ä–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏
- `DATABASE_URL` - URL –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL
- `DATA_PATH` - –ø—É—Ç—å –∫ –¥–∞–Ω–Ω—ã–º (–¥–ª—è DEV —Ä–µ–∂–∏–º–∞)
- `MODELS_PATH` - –ø—É—Ç—å –∫ –º–æ–¥–µ–ª—è–º ONNX

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –≤ `docker-compose.yml` –∏–ª–∏ —á–µ—Ä–µ–∑ `.env` —Ñ–∞–π–ª.

## üìù API Endpoints

### Health & Info
- `GET /health` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–∞
- `GET /api/v1/info` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ä–≤–∏—Å–µ

### Images (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- `GET /api/v1/images` - —Å–ø–∏—Å–æ–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- `GET /api/v1/images/{image_id}` - –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

### Inference (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- `POST /api/v1/inference/{image_id}` - –∑–∞–ø—É—Å–∫ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞

### Comparison (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- `POST /api/v1/comparison/{image_id}` - —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —ç–∫—Å–ø–µ—Ä—Ç–Ω–æ–π —Ä–∞–∑–º–µ—Ç–∫–æ–π

### Statistics (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- `GET /api/v1/statistics/{image_id}` - –º–µ—Ç—Ä–∏–∫–∏ –ø–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ —Ç–µ—Å—Ç—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ:

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
make test

# –¢–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞
make test-cov

# –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ docker-compose
docker-compose exec api pytest
docker-compose exec api pytest --cov=app --cov-report=term-missing
```

## üê≥ Docker

### –ß–µ—Ä–µ–∑ Makefile

```bash
make build      # –°–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã
make up         # –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
make up-d       # –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
make down       # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
make restart    # –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
make logs       # –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
make logs-api   # –õ–æ–≥–∏ —Ç–æ–ª—å–∫–æ API
make logs-db    # –õ–æ–≥–∏ —Ç–æ–ª—å–∫–æ PostgreSQL
make shell      # –û—Ç–∫—Ä—ã—Ç—å shell –≤ API –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
make db-shell   # –û—Ç–∫—Ä—ã—Ç—å PostgreSQL shell
make health     # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ —Å–µ—Ä–≤–∏—Å–∞
make clean      # –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, volumes, –∫—ç—à)
make test       # –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
make test-cov   # –¢–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
```

### –ù–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ Docker Compose

```bash
# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
docker build -t validation-microservice .

# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up --build

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f api

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
docker-compose exec api pytest
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

```bash
# Health check —á–µ—Ä–µ–∑ Makefile
make health

# –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é
curl http://localhost:8000/health

# –ò–ª–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
# http://localhost:8000/docs
```
